<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>–ñ—É—Ä–Ω–∞–ª –æ—Ü–µ–Ω–æ–∫</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- SheetJS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet" />
<style>
  /* --- –û–±—â–∏–µ —Å—Ç–∏–ª–∏ --- */
  :root {
    --color-bg-dark: #181818;
    --color-bg-darker: #121212;
    --color-bg-light: #f5f5f5;
    --color-text-dark: #fff;
    --color-text-light: #222;
    --color-accent: #ff9000;
    --color-accent-dark: #cc7300;
    --color-table-even: #202020;
    --color-table-odd: #232323;
    --color-border: #333;
    --color-input-bg-dark: #181818;
    --color-input-bg-light: #fff;
  }
  body {
    font-family: 'Montserrat', Arial, sans-serif;
    margin: 0;
    min-height: 100vh;
    background: var(--color-bg-dark);
    color: var(--color-text-dark);
    display: flex;
    flex-direction: column;
    transition: background 0.3s, color 0.3s;
  }
  body.light {
    background: var(--color-bg-light);
    color: var(--color-text-light);
  }
  /* --- –¢–µ–º–∞ --- */
  .theme-toggle {
    position: fixed;
    top: 12px;
    right: 12px;
    background: var(--color-accent);
    border: none;
    border-radius: 20px;
    padding: 8px 14px;
    font-weight: 700;
    color: var(--color-bg-dark);
    cursor: pointer;
    z-index: 1100;
    transition: background 0.3s, color 0.3s;
  }
  .theme-toggle:hover {
    background: var(--color-accent-dark);
  }
  body.light .theme-toggle {
    background: var(--color-accent-dark);
    color: var(--color-bg-light);
  }
  body.light .theme-toggle:hover {
    background: var(--color-accent);
    color: var(--color-bg-dark);
  }

  /* --- –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å–ª–µ–≤–∞ --- */
  #main-app {
    display: flex;
    flex: 1 1 auto;
    min-height: 0;
  }
  nav {
    background: #222;
    width: 220px;
    min-width: 220px;
    display: flex;
    flex-direction: column;
    color: var(--color-text-dark);
    box-shadow: 2px 0 8px #000a;
    transition: background 0.3s, color 0.3s;
  }
  body.light nav {
    background: #eee;
    color: var(--color-text-light);
    box-shadow: 2px 0 8px #aaa6;
  }
  nav .user-name {
    font-weight: 700;
    font-size: 1.3rem;
    padding: 20px 16px;
    border-bottom: 2px solid var(--color-accent);
    color: var(--color-accent);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  body.light nav .user-name {
    color: var(--color-accent-dark);
    border-bottom-color: var(--color-accent-dark);
  }
  nav .tabs {
    display: flex;
    flex-direction: column;
    flex-grow: 1;
  }
  nav .tab {
    padding: 16px 20px;
    color: inherit;
    cursor: pointer;
    font-weight: 700;
    font-size: 1.1rem;
    border-left: 4px solid transparent;
    transition: background 0.2s, border-color 0.3s, color 0.3s;
    user-select: none;
  }
  nav .tab:hover {
    background: var(--color-bg-darker);
  }
  body.light nav .tab:hover {
    background: #ddd;
  }
  nav .tab.active {
    background: var(--color-bg-darker);
    border-left-color: var(--color-accent);
    color: var(--color-accent);
  }
  body.light nav .tab.active {
    background: #ddd;
    border-left-color: var(--color-accent-dark);
    color: var(--color-accent-dark);
  }

  /* --- –ö–æ–Ω—Ç–µ–Ω—Ç --- */
  .content {
    flex-grow: 1;
    padding: 24px 32px;
    overflow-y: auto;
    background: var(--color-bg-darker);
    border-radius: 0 0 0 12px;
    box-shadow: inset 2px 0 8px #000a;
    transition: background 0.3s;
  }
  body.light .content {
    background: #fff;
    box-shadow: inset 2px 0 8px #aaa6;
  }
  h2 {
    color: var(--color-accent);
    font-size: 2rem;
    font-weight: 800;
    margin-bottom: 24px;
    letter-spacing: 0.5px;
  }
  body.light h2 {
    color: var(--color-accent-dark);
  }
  table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 12px;
    background: var(--color-bg-dark);
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px #000a;
    transition: background 0.3s;
  }
  body.light table {
    background: #fafafa;
    box-shadow: 0 2px 10px #ccc;
  }
  th, td {
    border: 1px solid var(--color-border);
    padding: 11px 14px;
    text-align: left;
    font-size: 1.05rem;
    transition: background 0.3s, color 0.3s;
  }
  th {
    background: var(--color-bg-darker);
    color: var(--color-accent);
    font-weight: 700;
  }
  body.light th {
    background: #ddd;
    color: var(--color-accent-dark);
  }
  tr:nth-child(even) {
    background: var(--color-table-even);
  }
  tr:nth-child(odd) {
    background: var(--color-table-odd);
  }
  body.light tr:nth-child(even) {
    background: #f5f5f5;
  }
  body.light tr:nth-child(odd) {
    background: #fff;
  }
  input, select, button {
    padding: 10px;
    margin: 4px;
    border-radius: 6px;
    border: 1px solid #444;
    font-size: 1rem;
    background: var(--color-input-bg-dark);
    color: var(--color-text-dark);
    transition: background 0.3s, color 0.3s, border-color 0.3s;
  }
  body.light input, body.light select, body.light button {
    background: var(--color-input-bg-light);
    color: var(--color-text-light);
    border-color: #bbb;
  }
  input:focus, select:focus {
    border-color: var(--color-accent);
    outline: none;
  }
  body.light input:focus, body.light select:focus {
    border-color: var(--color-accent-dark);
  }
  button {
    background: var(--color-accent);
    color: var(--color-bg-dark);
    font-weight: 700;
    border: none;
    cursor: pointer;
    transition: background 0.15s, color 0.15s;
  }
  button:hover {
    background: #fff;
    color: var(--color-accent);
  }
  body.light button {
    background: var(--color-accent-dark);
    color: var(--color-bg-light);
  }
  body.light button:hover {
    background: #fff;
    color: var(--color-accent-dark);
  }
  .form-row {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
    flex-wrap: wrap;
  }
  .actions {
    display: flex;
    gap: 7px;
  }
  .actions button {
    padding: 7px 14px;
    font-size: 1rem;
    background: #232323;
    color: var(--color-accent);
    border: 1px solid var(--color-accent);
  }
  .actions button:hover {
    background: var(--color-accent);
    color: var(--color-bg-dark);
  }
  .subject-input {
    width: 82px;
  }
  .photo {
    border-radius: 16px;
    width: 180px;
    margin-bottom: 16px;
    border: 3px solid var(--color-accent);
    box-shadow: 0 0 12px var(--color-accent);
    transition: border-color 0.3s;
  }
  body.light .photo {
    border-color: var(--color-accent-dark);
    box-shadow: 0 0 12px var(--color-accent-dark);
  }

  /* --- AUTH/REGISTRATION SCREEN --- */
  #auth-screen {
    position: fixed;
    inset: 0;
    background: var(--color-bg-dark);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    min-height: 100vh;
    transition: background 0.3s;
  }
  body.light #auth-screen {
    background: var(--color-bg-light);
  }
  .auth-box {
    background: #232323;
    border-radius: 14px;
    box-shadow: 0 8px 32px #000a;
    padding: 44px 38px 36px 38px;
    min-width: 340px;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 2;
    transition: background 0.3s, color 0.3s;
  }
  body.light .auth-box {
    background: #fff;
    color: var(--color-text-light);
    box-shadow: 0 8px 32px #aaa6;
  }
  .auth-box h2 {
    margin-bottom: 18px;
    color: var(--color-accent);
    font-size: 2rem;
  }
  body.light .auth-box h2 {
    color: var(--color-accent-dark);
  }
  .auth-box input {
    width: 220px;
    padding: 12px;
    margin-bottom: 16px;
    border-radius: 7px;
    border: 1px solid #444;
    font-size: 1rem;
    background: var(--color-input-bg-dark);
    color: var(--color-text-dark);
    transition: border 0.2s, background 0.3s, color 0.3s;
  }
  body.light .auth-box input {
    background: var(--color-input-bg-light);
    color: var(--color-text-light);
    border-color: #bbb;
  }
  .auth-box input:focus {
    border-color: var(--color-accent);
  }
  body.light .auth-box input:focus {
    border-color: var(--color-accent-dark);
  }
  .auth-box button {
    background: var(--color-accent);
    color: var(--color-bg-dark);
    border: none;
    border-radius: 7px;
    padding: 12px 32px;
    font-size: 1rem;
    font-weight: 700;
    margin-top: 8px;
    cursor: pointer;
    transition: background 0.3s, color 0.3s;
  }
  .auth-box button:hover {
    background: #fff;
    color: var(--color-accent);
  }
  body.light .auth-box button {
    background: var(--color-accent-dark);
    color: var(--color-bg-light);
  }
  body.light .auth-box button:hover {
    background: #fff;
    color: var(--color-accent-dark);
  }
  .auth-error {
    color: #ff5050;
    font-size: 1rem;
    margin-bottom: 10px;
    min-height: 24px;
  }
  .auth-switch {
    color: var(--color-text-dark);
    margin-top: 18px;
    font-size: 1rem;
  }
  .auth-switch a {
    color: var(--color-accent);
    cursor: pointer;
    text-decoration: underline;
  }
  body.light .auth-switch {
    color: var(--color-text-light);
  }
  body.light .auth-switch a {
    color: var(--color-accent-dark);
  }

  /* --- –ü–∞–¥–∞—é—â–∏–µ –æ—Ü–µ–Ω–∫–∏ (–∫–∞–∫ –ª–∏—Å—Ç—å—è) --- */
  .falling-grade {
    position: fixed;
    font-size: 2.5rem;
    font-weight: bold;
    opacity: 0.8;
    pointer-events: none;
    z-index: 1;
    user-select: none;
    animation: fall 3.5s linear forwards;
    will-change: transform, opacity;
    font-family: 'Montserrat', sans-serif;
    text-shadow: 0 0 4px rgba(0,0,0,0.6);
  }
  @keyframes fall {
    0% {
      transform: translateY(-60px) rotate(-30deg) scale(1);
      opacity: 0.8;
    }
    80% {
      opacity: 0.95;
    }
    100% {
      transform: translateY(100vh) rotate(40deg) scale(1.1);
      opacity: 0;
    }
  }

  /* --- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ --- */
  .tab-content {
    display: none;
  }
  .tab-content.active {
    display: block;
  }

  /* --- –ü–æ–º–æ—â—å - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å --- */
  #tab-4 ul {
    list-style: inside disc;
    font-size: 1.1rem;
    line-height: 1.5;
    max-width: 720px;
  }
  #tab-4 ul li {
    margin-bottom: 14px;
  }
  #tab-4 ul li b {
    color: var(--color-accent);
  }
  body.light #tab-4 ul li b {
    color: var(--color-accent-dark);
  }

  /* --- –°—Ç–∏–ª—å "–û –ø—Ä–æ–≥—Ä–∞–º–º–µ" –æ–±–Ω–æ–≤–ª—ë–Ω --- */
  #tab-5 {
    max-width: 600px;
  }
  #tab-5 p {
    font-size: 1.1rem;
    margin-bottom: 12px;
  }
  #tab-5 .photo {
    width: 160px;
    border-radius: 50%;
    margin-bottom: 20px;
    box-shadow: 0 0 15px var(--color-accent);
    transition: box-shadow 0.3s;
  }
  body.light #tab-5 .photo {
    box-shadow: 0 0 15px var(--color-accent-dark);
  }
  #tab-5 b {
    color: var(--color-accent);
  }
  body.light #tab-5 b {
    color: var(--color-accent-dark);
  }

  /* --- –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å --- */
  @media (max-width: 900px) {
    #main-app {
      flex-direction: column;
    }
    nav {
      width: 100%;
      min-width: auto;
      flex-direction: row;
      overflow-x: auto;
      box-shadow: none;
    }
    nav .user-name {
      flex: 1 0 auto;
      border-bottom: none;
      border-right: 2px solid var(--color-accent);
      padding: 12px 16px;
      font-size: 1rem;
      white-space: nowrap;
    }
    body.light nav .user-name {
      border-right-color: var(--color-accent-dark);
    }
    nav .tabs {
      flex-direction: row;
      flex-grow: 0;
    }
    nav .tab {
      border-left: none;
      border-right: 1px solid #444;
      padding: 12px 16px;
      font-size: 1rem;
      white-space: nowrap;
    }
    nav .tab:last-child {
      border-right: none;
    }
    .content {
      padding: 16px 20px;
      border-radius: 0;
      box-shadow: none;
    }
  }
  @media (max-width: 480px) {
    .form-row {
      flex-direction: column;
    }
    .subject-input {
      width: 100%;
    }
    input, select, button {
      width: 100%;
      box-sizing: border-box;
    }
  }
</style>
</head>
<body>
<button class="theme-toggle" id="themeToggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</button>

<!-- AUTH/REGISTRATION SCREEN -->
<div id="auth-screen">
  <div class="auth-box" id="auth-box">
    <h2 id="auth-title">–í—Ö–æ–¥</h2>
    <div id="auth-error" class="auth-error"></div>
    <input id="auth-login" type="text" placeholder="–õ–æ–≥–∏–Ω" autocomplete="username" />
    <input id="auth-password" type="password" placeholder="–ü–∞—Ä–æ–ª—å" autocomplete="current-password" />
    <input id="auth-name" type="text" placeholder="–í–∞—à–µ –∏–º—è" style="display:none" />
    <button onclick="submitAuth()">–í–æ–π—Ç–∏</button>
    <div class="auth-switch" id="auth-switch">
      –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a onclick="switchAuthMode(true)">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
    </div>
  </div>
</div>

<!-- MAIN APP -->
<div id="main-app" style="display:none">
  <nav>
    <div class="user-name" id="nav-user-name" title=""></div>
    <div class="tabs">
      <button class="tab active" onclick="showTab(0)">–ó–∞–≥—Ä—É–∑–∫–∞</button>
      <button class="tab" onclick="showTab(1)">–ñ—É—Ä–Ω–∞–ª</button>
      <button class="tab" onclick="showTab(2)">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—Ç–∞–±–ª–∏—Ü–∞)</button>
      <button class="tab" onclick="showTab(3)">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–≥—Ä–∞—Ñ–∏–∫–∏)</button>
      <button class="tab" onclick="showTab(4)">–ü–æ–º–æ—â—å</button>
      <button class="tab" onclick="showTab(5)">–û –ø—Ä–æ–≥—Ä–∞–º–º–µ</button>
    </div>
  </nav>
  <main class="content">
    <section id="tab-0" class="tab-content active">
      <h2>–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ü–µ–Ω–æ–∫ –∏–∑ —Ñ–∞–π–ª–∞</h2>
      <input type="file" id="fileInput" accept=".csv,.txt,.xlsx" />
      <button onclick="clearTable()">–û—á–∏—Å—Ç–∏—Ç—å</button>
      <div id="uploadTable"></div>
    </section>
    <section id="tab-1" class="tab-content">
      <h2>–ñ—É—Ä–Ω–∞–ª –æ—Ü–µ–Ω–æ–∫</h2>
      <div class="form-row">
        <input type="text" id="fio" placeholder="–§–ò–û" />
        <input type="text" id="class" placeholder="–ö–ª–∞—Å—Å" />
        <input type="number" class="subject-input" id="informatics" placeholder="–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞" min="2" max="5" />
        <input type="number" class="subject-input" id="physics" placeholder="–§–∏–∑–∏–∫–∞" min="2" max="5" />
        <input type="number" class="subject-input" id="math" placeholder="–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞" min="2" max="5" />
        <input type="number" class="subject-input" id="literature" placeholder="–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞" min="2" max="5" />
        <input type="number" class="subject-input" id="music" placeholder="–ú—É–∑—ã–∫–∞" min="2" max="5" />
        <button onclick="addOrUpdate()">–î–æ–±–∞–≤–∏—Ç—å/–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
      <div id="editInfo"></div>
      <div id="journalTable"></div>
      <button onclick="saveToCSV()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ CSV</button>
    </section>
    <section id="tab-2" class="tab-content">
      <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—Ç–∞–±–ª–∏—Ü–∞)</h2>
      <div id="statTable"></div>
    </section>
    <section id="tab-3" class="tab-content">
      <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–≥—Ä–∞—Ñ–∏–∫–∏)</h2>
      <canvas id="statChart" height="120"></canvas>
    </section>
    <section id="tab-4" class="tab-content">
      <h2>–ü–æ–º–æ—â—å</h2>
      <ul>
        <li><b>–ó–∞–≥—Ä—É–∑–∫–∞:</b> –í—ã –º–æ–∂–µ—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª —Å –æ—Ü–µ–Ω–∫–∞–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ <code>.csv</code>, <code>.txt</code> –∏–ª–∏ <code>.xlsx</code>. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ —Ñ–∞–π–ª–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏: <i>–§–ò–û, –ö–ª–∞—Å—Å, –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞, –§–∏–∑–∏–∫–∞, –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞, –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞, –ú—É–∑—ã–∫–∞</i>. –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Ç–æ—á–∫–æ–π —Å –∑–∞–ø—è—Ç–æ–π –∏–ª–∏ –∑–∞–ø—è—Ç–æ–π.</li>
        <li><b>–ñ—É—Ä–Ω–∞–ª:</b> –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –≤—Ä—É—á–Ω—É—é –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å —Å –æ—Ü–µ–Ω–∫–∞–º–∏, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å –µ—ë. –î–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ ‚úé —Ä—è–¥–æ–º —Å –∑–∞–ø–∏—Å—å—é, –≤–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ. –î–ª—è —É–¥–∞–ª–µ–Ω–∏—è - –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ üóëÔ∏è.</li>
        <li><b>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:</b> –ü–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–µ—Å—å –∂—É—Ä–Ω–∞–ª –≤ —Ñ–∞–π–ª CSV, —á—Ç–æ–±—ã –∏–º–µ—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –¥—Ä—É–≥–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö.</li>
        <li><b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—Ç–∞–±–ª–∏—Ü–∞):</b> –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–≤–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–ª–∞—Å—Å–∞–º –∏ –ø—Ä–µ–¥–º–µ—Ç–∞–º, –≤–∫–ª—é—á–∞—è —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª, –º–µ–¥–∏–∞–Ω—É –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫ (2,3,4,5) –≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö —á–∏—Å–ª–∞—Ö –∏ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö.</li>
        <li><b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–≥—Ä–∞—Ñ–∏–∫–∏):</b> –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º —Å –ø–æ–º–æ—â—å—é —Ü–≤–µ—Ç–Ω—ã—Ö —Å—Ç–æ–ª–±—á–∞—Ç—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.</li>
        <li><b>–ù–∞–≤–∏–≥–∞—Ü–∏—è:</b> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—é —Å–ª–µ–≤–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏. –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–≤–µ—Ä—Ö—É –º–µ–Ω—é.</li>
        <li><b>–¢–µ–º–∞:</b> –í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Å–≤–µ—Ç–ª–æ–π –∏ —Ç—ë–º–Ω–æ–π —Ç–µ–º—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è —Å—É—Ç–æ–∫.</li>
        <li><b>–ü–æ–¥–¥–µ—Ä–∂–∫–∞:</b> –ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º —á–µ—Ä–µ–∑ –≤–∫–ª–∞–¥–∫—É "–û –ø—Ä–æ–≥—Ä–∞–º–º–µ".</li>
      </ul>
    </section>
    <section id="tab-5" class="tab-content">
      <h2>–û –ø—Ä–æ–≥—Ä–∞–º–º–µ</h2>
      <img src="img/photo_2025-05-07_04-12-44.jpg" class="photo" alt="–§–æ—Ç–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞" />
      <p><b>–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:</b> –ö–∞–∂–∏–∫–∏–Ω –ò–ª—å—è –°–µ—Ä–≥–µ–µ–≤–∏—á</p>
      <p><b>Email:</b> <a href="mailto:psoleeva@mail.ru" style="color:inherit; text-decoration: underline;">kazhikin888@yandex.ru</a></p>
      <p><b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> <a href="tel:+79076669809" style="color:inherit; text-decoration: underline;">+79136990989</a></p>
      <p>–°–ø–∞—Å–∏–±–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è! –ú—ã —Å—Ç–∞—Ä–∞–µ–º—Å—è —Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –≤–µ–¥–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞ –æ—Ü–µ–Ω–æ–∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —É–¥–æ–±–Ω—ã–º –∏ –Ω–∞–≥–ª—è–¥–Ω—ã–º.</p>
    </section>
  </main>
</div>

<script>
  // --- –¢–µ–º–∞ ---
  const themeToggleBtn = document.getElementById('themeToggle');
  function applyTheme(theme) {
    if (theme === 'light') {
      document.body.classList.add('light');
      themeToggleBtn.textContent = '–¢—ë–º–Ω–∞—è —Ç–µ–º–∞';
      localStorage.setItem('theme', 'light');
    } else {
      document.body.classList.remove('light');
      themeToggleBtn.textContent = '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
      localStorage.setItem('theme', 'dark');
    }
  }
  themeToggleBtn.onclick = () => {
    const isLight = document.body.classList.contains('light');
    applyTheme(isLight ? 'dark' : 'light');
  };
  // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É –∏–∑ localStorage –∏–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç—ë–º–Ω—É—é
  applyTheme(localStorage.getItem('theme') || 'dark');

  // --- AUTH/REG ---
  let isReg = false;
  let currentUser = null;
  function switchAuthMode(reg) {
    isReg = reg;
    document.getElementById('auth-title').innerText = reg ? '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è' : '–í—Ö–æ–¥';
    document.getElementById('auth-name').style.display = reg ? '' : 'none';
    document.querySelector('.auth-box button').innerText = reg ? '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è' : '–í–æ–π—Ç–∏';
    document.getElementById('auth-switch').innerHTML = reg ?
      '–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a onclick="switchAuthMode(false)">–í–æ–π—Ç–∏</a>' :
      '–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a onclick="switchAuthMode(true)">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>';
    document.getElementById('auth-error').innerText = '';
  }
  function submitAuth() {
    let login = document.getElementById('auth-login').value.trim();
    let pass = document.getElementById('auth-password').value.trim();
    let name = document.getElementById('auth-name').value.trim();
    if (!login || !pass || (isReg && !name)) {
      document.getElementById('auth-error').innerText = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';
      return;
    }
    let users = JSON.parse(localStorage.getItem('ph_users') || '[]');
    if (isReg) {
      if (users.find(u => u.login === login)) {
        document.getElementById('auth-error').innerText = '–õ–æ–≥–∏–Ω —É–∂–µ –∑–∞–Ω—è—Ç';
        return;
      }
      users.push({ login, pass, name });
      localStorage.setItem('ph_users', JSON.stringify(users));
      document.getElementById('auth-error').innerText = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ.';
      switchAuthMode(false);
    } else {
      let user = users.find(u => u.login === login && u.pass === pass);
      if (!user) {
        document.getElementById('auth-error').innerText = '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
        return;
      }
      currentUser = user;
      document.getElementById('auth-screen').style.display = 'none';
      document.getElementById('main-app').style.display = '';
      document.getElementById('nav-user-name').innerText = user.name;
      document.getElementById('nav-user-name').title = user.name;
      showTab(0);
    }
  }
  document.getElementById('auth-box').addEventListener('keydown', function (e) {
    if (e.key === 'Enter') submitAuth();
  });

  // --- –ü–∞–¥–∞—é—â–∏–µ –æ—Ü–µ–Ω–∫–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ---
  function spawnGrade() {
    const grades = [2, 3, 4, 5];
    const grade = grades[Math.floor(Math.random() * grades.length)];
    const colors = { 2: '#ff5050', 3: '#ffeb3b', 4: '#40c4ff', 5: '#00e676' };
    const el = document.createElement('div');
    el.className = 'falling-grade';
    el.innerText = grade;
    el.style.left = Math.random() * 96 + 'vw';
    el.style.color = colors[grade];
    el.style.transform += ` rotate(${Math.random() * 60 - 30}deg)`;
    el.style.fontSize = (2.0 + Math.random() * 1.3) + 'rem';
    el.style.opacity = 0.7 + Math.random() * 0.3;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 3500);
  }
  let gradeInterval = setInterval(() => {
    if (document.getElementById('auth-screen').style.display !== 'none') spawnGrade();
  }, 420);

  // --- TABS ---
  function showTab(idx) {
    document.querySelectorAll('.tab-content').forEach((el, i) => {
      el.classList.toggle('active', i === idx);
    });
    document.querySelectorAll('nav .tab').forEach((el, i) => {
      el.classList.toggle('active', i === idx);
    });
    if (idx === 1) renderJournal();
    if (idx === 2) renderStatTable();
    if (idx === 3) renderStatChart();
  }

  // --- –ñ–£–†–ù–ê–õ –û–¶–ï–ù–û–ö ---
  let journal = [];
  let editIndex = null;
  const subjects = ["–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞", "–§–∏–∑–∏–∫–∞", "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞", "–ú—É–∑—ã–∫–∞"];
  const requiredHeaders = ["–§–ò–û", "–ö–ª–∞—Å—Å", ...subjects];

  document.getElementById('fileInput').addEventListener('change', function (e) {
    let file = e.target.files[0];
    if (!file) return;
    let ext = file.name.split('.').pop().toLowerCase();
    if (['csv', 'txt'].includes(ext)) {
      let reader = new FileReader();
      reader.onload = function (e) {
        let text = e.target.result;
        let rows = text.split(/\r?\n/).filter(Boolean).map(row => row.split(/[;,]/));
        processRows(rows);
      };
      reader.readAsText(file);
    } else if (ext === 'xlsx') {
      let reader = new FileReader();
      reader.onload = function (e) {
        let data = new Uint8Array(e.target.result);
        let workbook = XLSX.read(data, { type: 'array' });
        let sheet = workbook.Sheets[workbook.SheetNames[0]];
        let rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });
        processRows(rows);
      };
      reader.readAsArrayBuffer(file);
    } else {
      alert('–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ .csv, .txt, .xlsx');
    }
  });

  function processRows(rows) {
    if (rows.length === 0) {
      alert('–§–∞–π–ª –ø—É—Å—Ç–æ–π');
      return;
    }
    const headers = rows[0].map(h => h.trim());
    const missing = requiredHeaders.filter(h => !headers.includes(h));
    if (missing.length > 0) {
      alert('–í —Ñ–∞–π–ª–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–æ–ª–æ–Ω–∫–∏: ' + missing.join(', '));
      return;
    }
    let idx = {};
    requiredHeaders.forEach(h => { idx[h] = headers.indexOf(h); });
    let loaded = [];
    for (let i = 1; i < rows.length; ++i) {
      let r = rows[i];
      if (r.length < headers.length) continue;
      let entry = {
        fio: r[idx["–§–ò–û"]],
        class: r[idx["–ö–ª–∞—Å—Å"]],
      };
      subjects.forEach(s => entry[s] = parseInt(r[idx[s]]));
      loaded.push(entry);
    }
    journal = loaded;
    renderUploadTable();
    renderJournal();
  }

  function renderUploadTable() {
    let html = '<table><tr><th>–§–ò–û</th><th>–ö–ª–∞—Å—Å</th>';
    subjects.forEach(s => html += `<th>${s}</th>`);
    html += '</tr>';
    for (let row of journal)
      html += `<tr><td>${row.fio}</td><td>${row.class}</td>${subjects.map(s => `<td>${row[s]}</td>`).join('')}</tr>`;
    html += '</table>';
    document.getElementById('uploadTable').innerHTML = html;
  }

  function clearTable() {
    journal = [];
    renderUploadTable();
    renderJournal();
  }

  function addOrUpdate() {
    let fio = document.getElementById('fio').value.trim();
    let cls = document.getElementById('class').value.trim();
    let entry = { fio, class: cls };
    let valid = fio && cls;
    subjects.forEach(s => {
      let val = parseInt(document.getElementById(subjectToId(s)).value);
      entry[s] = val;
      if (isNaN(val) || val < 2 || val > 5) valid = false;
    });
    if (!valid) {
      alert('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤–≤–æ–¥–∞!');
      return;
    }
    if (editIndex !== null) {
      journal[editIndex] = entry;
      editIndex = null;
      document.getElementById('editInfo').innerHTML = '';
    } else {
      journal.push(entry);
    }
    document.getElementById('fio').value = '';
    document.getElementById('class').value = '';
    subjects.forEach(s => document.getElementById(subjectToId(s)).value = '');
    renderJournal();
    renderUploadTable();
  }
  function subjectToId(s) {
    return {
      "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞": "informatics",
      "–§–∏–∑–∏–∫–∞": "physics",
      "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞": "math",
      "–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞": "literature",
      "–ú—É–∑—ã–∫–∞": "music"
    }[s];
  }

  function renderJournal() {
    let html = '<table><tr><th>–§–ò–û</th><th>–ö–ª–∞—Å—Å</th>';
    subjects.forEach(s => html += `<th>${s}</th>`);
    html += '<th>–î–µ–π—Å—Ç–≤–∏—è</th></tr>';
    journal.forEach((row, i) => {
      html += `<tr>
          <td>${row.fio}</td>
          <td>${row.class}</td>
          ${subjects.map(s => `<td>${row[s]}</td>`).join('')}
          <td class="actions">
              <button onclick="editRow(${i})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úé</button>
              <button onclick="deleteRow(${i})" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
          </td>
      </tr>`;
    });
    html += '</table>';
    document.getElementById('journalTable').innerHTML = html;
  }

  function editRow(i) {
    let row = journal[i];
    document.getElementById('fio').value = row.fio;
    document.getElementById('class').value = row.class;
    subjects.forEach(s => document.getElementById(subjectToId(s)).value = row[s]);
    editIndex = i;
    document.getElementById('editInfo').innerHTML = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏. –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å/–°–æ—Ö—Ä–∞–Ω–∏—Ç—å".';
  }

  function deleteRow(i) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?')) {
      journal.splice(i, 1);
      renderJournal();
      renderUploadTable();
    }
  }

  function saveToCSV() {
    let csv = requiredHeaders.join(';') + '\n';
    journal.forEach(r => {
      csv += `${r.fio};${r.class};${subjects.map(s => r[s]).join(';')}\n`;
    });
    let blob = new Blob([csv], { type: 'text/csv' });
    let a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'journal.csv';
    a.click();
  }

  // --- –°–¢–ê–¢–ò–°–¢–ò–ö–ê ---
  function avg(arr) { if (!arr.length) return 0; return arr.reduce((a, b) => a + b, 0) / arr.length; }
  function median(arr) {
    if (!arr.length) return 0;
    let s = arr.slice().sort((a, b) => a - b);
    let mid = Math.floor(s.length / 2);
    return s.length % 2 ? s[mid] : ((s[mid - 1] + s[mid]) / 2).toFixed(1);
  }
  function count(arr, val) { return arr.filter(x => x === val).length; }
  function perc(arr, val) { if (!arr.length) return 0; return Math.round(count(arr, val) / arr.length * 100); }
  function renderStatTable() {
    let byClass = {};
    journal.forEach(r => {
      if (!byClass[r.class]) byClass[r.class] = {};
      subjects.forEach(s => {
        if (!byClass[r.class][s]) byClass[r.class][s] = [];
        byClass[r.class][s].push(r[s]);
      });
    });
    let html = '<h3 style="color:' + (document.body.classList.contains('light') ? 'var(--color-accent-dark)' : 'var(--color-accent)') + ';">–ü–æ –∫–ª–∞—Å—Å–∞–º –∏ –ø—Ä–µ–¥–º–µ—Ç–∞–º</h3><table><tr><th>–ö–ª–∞—Å—Å</th><th>–ü—Ä–µ–¥–º–µ—Ç</th><th>–°—Ä–µ–¥–Ω—è—è</th><th>–ú–µ–¥–∏–∞–Ω–∞</th><th>–ö–æ–ª-–≤–æ</th><th>2</th><th>3</th><th>4</th><th>5</th></tr>';
    for (let cls in byClass) {
      for (let s of subjects) {
        let grades = byClass[cls][s] || [];
        html += `<tr>
            <td>${cls}</td>
            <td>${s}</td>
            <td>${avg(grades).toFixed(2)}</td>
            <td>${median(grades)}</td>
            <td>${grades.length}</td>
            <td>${count(grades, 2)} (${perc(grades, 2)}%)</td>
            <td>${count(grades, 3)} (${perc(grades, 3)}%)</td>
            <td>${count(grades, 4)} (${perc(grades, 4)}%)</td>
            <td>${count(grades, 5)} (${perc(grades, 5)}%)</td>
        </tr>`;
      }
    }
    html += '</table>';
    let bySubject = {};
    subjects.forEach(s => bySubject[s] = []);
    journal.forEach(r => {
      subjects.forEach(s => bySubject[s].push(r[s]));
    });
    html += '<h3 style="color:' + (document.body.classList.contains('light') ? 'var(--color-accent-dark)' : 'var(--color-accent)') + ';">–ü–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º (–≤—Å–µ –∫–ª–∞—Å—Å—ã)</h3><table><tr><th>–ü—Ä–µ–¥–º–µ—Ç</th><th>–°—Ä–µ–¥–Ω—è—è</th><th>–ú–µ–¥–∏–∞–Ω–∞</th><th>–ö–æ–ª-–≤–æ</th><th>2</th><th>3</th><th>4</th><th>5</th></tr>';
    for (let s of subjects) {
      let grades = bySubject[s];
      html += `<tr>
          <td>${s}</td>
          <td>${avg(grades).toFixed(2)}</td>
          <td>${median(grades)}</td>
          <td>${grades.length}</td>
          <td>${count(grades, 2)} (${perc(grades, 2)}%)</td>
          <td>${count(grades, 3)} (${perc(grades, 3)}%)</td>
          <td>${count(grades, 4)} (${perc(grades, 4)}%)</td>
          <td>${count(grades, 5)} (${perc(grades, 5)}%)</td>
      </tr>`;
    }
    html += '</table>';
    document.getElementById('statTable').innerHTML = html;
  }

  // --- –ì–†–ê–§–ò–ö–ò ---
  let chart;
  function renderStatChart() {
    let bySubject = {};
    subjects.forEach(s => bySubject[s] = []);
    journal.forEach(r => {
      subjects.forEach(s => bySubject[s].push(r[s]));
    });
    let labels = subjects;
    let data2 = labels.map(s => count(bySubject[s], 2));
    let data3 = labels.map(s => count(bySubject[s], 3));
    let data4 = labels.map(s => count(bySubject[s], 4));
    let data5 = labels.map(s => count(bySubject[s], 5));
    let ctx = document.getElementById('statChart').getContext('2d');
    if (chart) chart.destroy();
    chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels,
        datasets: [
          { label: '–û—Ü–µ–Ω–∫–∞ 2', data: data2, backgroundColor: '#ff5050' },
          { label: '–û—Ü–µ–Ω–∫–∞ 3', data: data3, backgroundColor: '#ffeb3b' },
          { label: '–û—Ü–µ–Ω–∫–∞ 4', data: data4, backgroundColor: '#40c4ff' },
          { label: '–û—Ü–µ–Ω–∫–∞ 5', data: data5, backgroundColor: '#00e676' },
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'top',
            labels: {
              color: document.body.classList.contains('light') ? '#222' : '#fff',
              font: { size: 18, weight: 'bold', family: 'Montserrat' }
            }
          },
          title: {
            display: false
          }
        },
        scales: {
          x: {
            ticks: { color: document.body.classList.contains('light') ? '#222' : '#fff', font: { size: 16, weight: 'bold' } },
            grid: { color: document.body.classList.contains('light') ? '#ccc' : '#333' }
          },
          y: {
            beginAtZero: true,
            ticks: { stepSize: 1, color: document.body.classList.contains('light') ? '#222' : '#fff', font: { size: 16, weight: 'bold' } },
            grid: { color: document.body.classList.contains('light') ? '#ccc' : '#333' }
          }
        }
      }
    });
  }
</script>
</body>
</html>
